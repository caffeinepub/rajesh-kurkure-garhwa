{
  "kind": "build_request",
  "title": "Fix deployment failure by correcting Motoko backend persistence and migration wiring",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Investigate and fix the root cause of the build/deploy pipeline failure so the project compiles and deploys successfully.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-2"
        ],
        "quotes": [
          "Fix it"
        ]
      },
      "acceptanceCriteria": [
        "`dfx build` (or the platform build step) completes without errors for both backend and frontend.",
        "Deployment completes successfully (no build-time or deploy-time errors)."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Make `backend/main.mo` compile reliably on the Internet Computer toolchain by replacing the current `mo:core/Map` usage and any non-compiling Map operations with a supported, correct data structure and APIs (while preserving the existing product CRUD interface semantics).",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-2"
        ],
        "quotes": [
          "Fix it"
        ]
      },
      "acceptanceCriteria": [
        "Motoko backend compiles without errors.",
        "`addProduct`, `getProductById`, `getAllProducts`, `updateProduct`, and `deleteProduct` behave correctly (create/read/list/update/delete)."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Implement stable, upgrade-safe persistence for products and `nextId` in the single Motoko actor so product data is retained across canister upgrades/redeploys.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-2"
        ],
        "quotes": [
          "Fix it"
        ]
      },
      "acceptanceCriteria": [
        "After adding products, upgrading/redeploying the canister does not erase product data.",
        "`nextId` continues incrementing after upgrade (no ID reuse)."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Ensure the backend upgrade/migration setup is consistent with the project’s migration policy (conditional) by providing/repairing `backend/migration.mo` (and any required wiring) so state initialization/upgrade does not break deployment.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-2"
        ],
        "quotes": [
          "Fix it"
        ]
      },
      "acceptanceCriteria": [
        "The project contains a valid `backend/migration.mo` that matches the backend’s stable state needs.",
        "Upgrades do not trap due to missing/incorrect migration logic."
      ]
    },
    {
      "id": "REQ-5",
      "text": "Keep all existing user-facing text in English and ensure the existing global footer content remains unchanged, including the text \"Mobile: 9973279335\".",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-2"
        ],
        "quotes": [
          "Fix it"
        ]
      },
      "acceptanceCriteria": [
        "The footer still displays \"Mobile: 9973279335\" exactly.",
        "No user-facing text is changed to a non-English language as part of the fix."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in `backend/main.mo` (no multi-canister/backend services).",
    "Only generate/update `backend/migration.mo` when needed for state upgrade safety (migration policy: conditional).",
    "Do not edit files under `frontend/src/components/ui` or other frontend immutable paths listed in SYSTEM_CONTEXT."
  ],
  "nonGoals": [
    "Adding new product fields or changing the product CRUD API shape beyond what is required to fix compilation/persistence/deployment.",
    "Adding third-party services, external databases, or non-Internet-Identity authentication.",
    "Implementing real-time features (WebSockets/push notifications) or new unrelated UI features."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}